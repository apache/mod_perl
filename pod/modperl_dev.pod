=head1 Disclaimer

This is preliminary developer's documentation, incomplete and probably
inaccurate at times. Feel free to contribute.

=head1 Installing

Download the httpd-2.0 and modperl-2.0 tarballs, and extract them in the
same directory.

Or use anoncvs (password is "anoncvs"):

 % cvs -d :pserver:anoncvs@www.apache.org:/home/cvspublic login
 % cvs -d :pserver:anoncvs@www.apache.org:/home/cvspublic co modperl-2.0
 % cvs -d :pserver:anoncvs@www.apache.org:/home/cvspublic co httpd-2.0
 % cd httpd-2.0/srclib
 % cvs -d :pserver:anoncvs@www.apache.org:/home/cvspublic co apr
 % cvs -d :pserver:anoncvs@www.apache.org:/home/cvspublic co apr-util
 % cd ..
 % ./buildconf
 % ./configure --prefix=$HOME/apache-2.0 \
   --with-mpm=threaded --enable-so
 % make && make install

For bleeding edge Perl:

 % rsync -auvz rsync://ftp.linux.activestate.com/perl-current/ perl-current
 % cd perl-current
 % ./Configure -des -Dprefix=$HOME/bleedperl \
   -Dusethreads -Doptimize='-g' -Dusedevel
 % make && make test && make install

=head1 Compiling

=head2 Create the build environment

  % cd modperl-2.0
  % perl Makefile.PL MP_GENERATE_XS=1 MP_USE_DSO=1 \
    MP_APXS=$apache_prefix/bin/apxs && make

I<options>  an optional list of (key,value) pairs. Currently all options are
boolean, set them with MP_XXX=1.

=over 4

=item MP_PROMPT_DEFAULT

Accept default values for all would-be prompts

=item MP_GENERATE_XS

Generate xs code from parsed source headers in I<xs/tables/$httpd_version>.

=item MP_USE_DSO

Build mod_perl as a DSO

=item MP_STATIC_EXTS

Build Apache::*.xs as static extensions

=item MP_USE_GTOP

Link with libgtop and enable libgtop reporting

=item MP_DEBUG

Turn on debugging (-g -lperld) and tracing

=item MP_MAINTAINER

NOTE: apache must be build with --enable-maintainer-mode

Maintainer compile mode, turn on MP_DEBUG and add gcc flags:

 -DAP_DEBUG \
 -Wall -Wmissing-prototypes -Wstrict-prototypes -Wmissing-declarations

=item MP_TRACE

Enable tracing

=item MP_CCOPTS

Add to compiler flags, e.g.

 MP_CCOPTS = -Werror

=item MP_INST_APACHE2

Install *.pm relative to Apache2/ directory

=item MP_OPTIONS_FILE

Read options from given file

=back

mod_perl specific compiler opts:

=over 4

=item -DMP_IOBUFSIZE

Change the default mod_perl's 8k IO buffer size, e.g. 16k:

 MP_CCOPTS=-DMP_IOBUFSIZE=16384

=back



Options can also be specified in the file C<makepl_args.mod_perl2>.
Command line options override those from C<makepl_args_mod_perl2>
and those from MP_OPTIONS_FILE.

=head2 Compile mod_perl

  % make

=head2 Configure and compile Apache

  % cd ../httpd-2.0
  % ./configure --with-mpm=threaded
  % make

=head2 Howto generate source tables

All mod_perl-2.0 xs code is generated from parsed header files.  While
in pre-release mode, a version of these tables will be checked in to
I<xs/tables/current>.  Should you wish to update these tables, here's
how:

NOTE: requires C::Scan 0.75, which at the moment is unreleased, there
is a working copy here: http://perl.apache.org/~dougm/Scan.pm

NOTE: source_scan.pl is a HEAVY process, do not be alarmed.

% perl util/source_scan.pl apxs $apache_prefix/bin/apxs

=head1 Support

Discussion of mod_perl-2.0 currently takes place on the
dev@perl.apache.org list.
Any problems/questions should be report to that list, be sure to
include:

=over 4

=item perl -V

=item httpd -V

=item Makefile.PL options

=back

hint:

 % perl util/config.pl

will generate this requested information.

=head1 mod_perl configuration directives

=head2 Installing handlers

=over 4

=item PerlChildInitHandler

=item PerlOpenLogsHandler

=item PerlPostConfigHandler

=item PerlPreConnectionHandler

=item PerlProcessConnectionHandler

=item PerlHeaderParserHandler

=item PerlAccessHandler

=item PerlAuthenHandler

=item PerlAuthzHandler

=item PerlTypeHandler

=item PerlFixupHandler

=item PerlOutputFilterHandler

=item PerlResponseHandler

=item PerlLogHandler

=item PerlPostReadRequestHandler

=item PerlTransHandler

=back

=head2 General directives

=over 4

=item PerlSwitches switches

pass switches to the Perl command line. For example, to enable
warnings:

  PerlSwitches -w

=item PerlTrace [level]

set the trace level. This directive is enabled when mod_perl is compiled with
the MP_TRACE option. C<level> is either:

all

which sets maximum logging and debugging levels;

a combination of one or more option letters from the following list:

  d  directive processing
  f  filters
  g  Perl runtime interaction
  h  handlers
  i  interpreter pool management
  m  memory allocations
  s  perl sections

a numeric value.

When C<level> is not specified, the tracing level will be set to the
value of the MOD_PERL_TRACE environment variable.

=back

=head2 Threaded mode directives

These directives are enabled only in a threaded mod_perl+Apache combo.

=over 4

=item PerlInterpStart

Number of Perl interpreters to start

=item PerlInterpMax

Max number of running Perl interpreters

=item PerlInterpMaxSpare

Max number of spare Perl interpreters

=item PerlInterpMinSpare

Min number of spare Perl interpreters

=item PerlInterpMaxRequests

Max number of requests per Perl interpreters

=back

=head2 PerlOptions Directive

Enable/Disable Options.  Options include:

=over 4

=item Parent

Create a new parent Perl interpreter for the given VirtualHost
(implies Clone).

=item Clone

Give the VirtualHost its own interpreter pool.

=item Enabled

On by default, used to disable mod_perl for a given VirtualHost.

=item Perl*Handler

Disable Perl*Handlers, all compiled in handlers are enabled by default.

=back

Examples:

 #disable mod_perl for this host
 <VirtualHost ...>
 PerlOptions -Enable
 </VirtualHost>

 #create 2 Parent Perls,
 #each pointing to a different developer library tree
 <VirtualHost ...>
  ServerName dev1
  PerlOptions +Parent
  PerlSwitches -Mblib=/home/dev1/lib/perl
 </VirtualHost>

 <VirtualHost ...>
  ServerName dev2
  PerlOptions +Parent
  PerlSwitches -Mblib=/home/dev2/lib/perl
 </VirtualHost>

 #give VirtualHost its own interpreter pool
 <VirtualHost ...>
  PerlOptions +Clone
  PerlInterpStart 2
  PerlInterpMax 2
 </VirtualHost>

 #disable handlers
 <VirtualHost ...>
  PerlOptions -Authen -Authz -Access
 </VirtualHost>
